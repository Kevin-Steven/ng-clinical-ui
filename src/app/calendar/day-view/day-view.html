<div class="flex h-full flex-col">

  <!-- CUERPO PRINCIPAL -->
  <div class="flex flex-auto overflow-hidden bg-white dark:bg-gray-dark rounded-xl">

    <!-- ZONA IZQUIERDA: Horario del Día (Scrollable) -->
    <div class="flex flex-auto overflow-y-auto custom-scrollbar">

      <!-- Grid de Horas -->
      <div class="flex w-full flex-auto">

        <!-- Gutter (Espaciador Izquierdo) -->
        <div class="w-14 flex-none bg-white dark:bg-gray-dark ring-1 ring-gray-200 dark:ring-gray-800"></div>

        <div class="grid flex-auto grid-cols-1 grid-rows-1">

          <!-- Líneas Horizontales (Fondo) -->
          <div class="col-start-1 col-end-2 row-start-1 grid divide-y divide-gray-200 dark:divide-gray-800"
            style="grid-template-rows: repeat(48, minmax(3.5rem, 1fr))">

            <div class="row-end-1 h-7"></div>

            @for (hour of hours; track hour) {
            <!-- 2 divs por hora (intervalos de 30 min) -->
            <div>
              <div
                class="sticky left-0 -ml-14 -mt-2.5 w-14 pr-2 text-right text-theme-xs leading-5 text-gray-400 dark:text-gray-500 font-medium">
                {{ hour === 0 ? '12AM' : (hour > 12 ? (hour - 12) + 'PM' : hour + (hour === 12 ? 'PM' : 'AM')) }}
              </div>
            </div>
            <div></div> <!-- Media hora -->
            }
          </div>

          <!-- Eventos del Día (Superpuesto) -->
          <div class="col-start-1 col-end-2 row-start-1 grid grid-cols-1 grid-rows-1 sm:grid-cols-1"
            style="grid-template-rows: repeat(48, minmax(3.5rem, 1fr))">

            <!-- Eventos -->
            @for (event of dayEvents(); track event.id) {
            <li class="relative mt-px flex pr-4" [style.grid-row]="event.gridRowStart + ' / span ' + event.gridRowSpan">

              <a href="#" (click)="$event.preventDefault()"
                [class]="
                    event.color === 'brand' ? 'bg-brand-50 border-brand-200 text-brand-700 hover:bg-brand-100 dark:bg-brand-500/20 dark:border-brand-500/30 dark:text-brand-400 dark:hover:bg-brand-500/30' :
                    event.color === 'success' ? 'bg-success-50 border-success-200 text-success-700 hover:bg-success-100 dark:bg-success-500/20 dark:border-success-500/30 dark:text-success-400 dark:hover:bg-success-500/30' :
                    event.color === 'error' ? 'bg-error-50 border-error-200 text-error-700 hover:bg-error-100 dark:bg-error-500/20 dark:border-error-500/30 dark:text-error-400 dark:hover:bg-error-500/30' :
                    event.color === 'warning' ? 'bg-warning-50 border-warning-200 text-warning-700 hover:bg-warning-100 dark:bg-warning-500/20 dark:border-warning-500/30 dark:text-warning-400 dark:hover:bg-warning-500/30' :
                    'bg-gray-50 border-gray-200 text-gray-700 hover:bg-gray-100 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300 dark:hover:bg-gray-700'"
                class="group absolute inset-1 flex flex-col overflow-y-auto rounded-lg p-3 text-xs leading-5 border shadow-sm transition-all duration-200">

                <p class="order-1 font-semibold text-theme-sm mb-1">{{ event.title }}</p>

                <p class="opacity-80 group-hover:opacity-100 text-theme-xs font-medium">
                  <time [attr.datetime]="event.start.toISOString()">
                    {{ event.start | date:'shortTime' }} - {{ event.end | date:'shortTime' }}
                  </time>
                </p>
              </a>
            </li>
            }
          </div>

        </div>
      </div>
    </div>

    <!-- ZONA DERECHA: Mini Calendario (Hidden en mobile) -->
    <div
      class="hidden w-100 flex-none border-l border-gray-200 dark:border-gray-800 px-8 py-10 lg:block bg-gray-50 dark:bg-gray-900/50">

      <!-- Navegación Mini Mes -->
      <div class="flex items-center text-center text-gray-900 dark:text-white">

        <!-- Botón Previo -->
        <button type="button" (click)="prevMonth()"
          class="-m-1.5 flex flex-none items-center justify-center p-1.5 text-gray-400 hover:text-gray-500 dark:text-gray-500 dark:hover:text-gray-300 transition-colors">
          <span class="sr-only">Previous month</span>
          <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
            <path fill-rule="evenodd"
              d="M12.79 5.23a.75.75 0 01-.02 1.06L8.06 10l3.72 3.72a.75.75 0 11-1.06 1.06l-4.25-4.25a.75.75 0 010-1.06l4.25-4.25a.75.75 0 011.06 0z"
              clip-rule="evenodd" />
          </svg>
        </button>

        <div class="flex-auto text-theme-sm font-semibold text-gray-900 dark:text-white/90">
          {{ currentMonthName() | titlecase }}
        </div>

        <!-- Botón Siguiente -->
        <button type="button" (click)="nextMonth()"
          class="-m-1.5 flex flex-none items-center justify-center p-1.5 text-gray-400 hover:text-gray-500 dark:text-gray-500 dark:hover:text-gray-300 transition-colors">
          <span class="sr-only">Next month</span>
          <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
            <path fill-rule="evenodd"
              d="M7.21 14.77a.75.75 0 01.02-1.06L11.94 10 7.23 6.29a.75.75 0 011.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z"
              clip-rule="evenodd" />
          </svg>
        </button>
      </div>

      <!-- Cabecera Días Mini Calendario -->
      <div
        class="mt-6 grid grid-cols-7 text-center text-theme-xs leading-6 text-gray-500 dark:text-gray-400 font-medium">
        <div>L</div>
        <div>M</div>
        <div>M</div>
        <div>J</div>
        <div>V</div>
        <div>S</div>
        <div>D</div>
      </div>

      <!-- Cuerpo Mini Calendario -->
      <div
        class="isolate mt-2 grid grid-cols-7 gap-px rounded-lg bg-gray-200 dark:bg-gray-700 shadow-sm ring-1 ring-gray-200 dark:ring-gray-700 overflow-hidden">

        @for (day of miniCalendarDays(); track $index) {
        <button type="button" (click)="selectDate(day.date)" [class]="day.isCurrentMonth
              ? 'bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100'
              : 'bg-gray-50 dark:bg-gray-800 text-gray-400 dark:text-gray-600'"
          class="py-1.5 hover:bg-gray-100 dark:hover:bg-white/5 focus:z-10 relative transition-colors duration-150">

          <time [attr.datetime]="day.isoDate"
            class="mx-auto flex h-7 w-7 items-center justify-center rounded-full text-theme-xs"
            [class.bg-brand-500]="day.isSelected" [class.text-white]="day.isSelected"
            [class.font-semibold]="day.isSelected || day.isToday"
            [class.text-brand-600]="day.isToday && !day.isSelected"
            [class.dark:text-brand-400]="day.isToday && !day.isSelected"
            [class.font-bold]="day.isToday && !day.isSelected">
            {{ day.dayNumber }}
          </time>
        </button>
        }
      </div>

    </div>
  </div>
</div>
